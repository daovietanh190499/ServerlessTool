{% extends 'dashboard/base.html' %}

{% block title %}Soạn thảo Script - {{ tool.name }}{% endblock %}

{% block extra_css %}
<style>
    #editor {
        min-height: 500px;
        width: 100%;
        border: 1px solid #ddd;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h2>Soạn thảo Script - {{ tool.name }}</h2>
        <a href="{% url 'tool_detail' tool.slug %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Quay lại
        </a>
    </div>
    <div class="card-body">
        <form method="post" id="scriptForm">
            {% csrf_token %}
            <div id="editor">{{ tool.python_script|default:"# Viết script Python của bạn ở đây\n\ndef process(input_data):\n    # Xử lý input_data\n    result = input_data\n    return result" }}</div>
            <input type="hidden" name="script_content" id="script_content">
            
            <div class="mt-3 d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" onclick="window.location.href='{% url 'tool_detail' tool.slug %}'">Hủy</button>
                <button type="submit" class="btn btn-primary">Lưu Script</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
<script>
    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
    require(['vs/editor/editor.main'], function() {
        var editor = monaco.editor.create(document.getElementById('editor'), {
            value: document.getElementById('editor').textContent,
            language: 'python',
            theme: 'vs-dark',
            automaticLayout: true
        });
        
        document.getElementById('scriptForm').addEventListener('submit', function() {
            document.getElementById('script_content').value = editor.getValue();
        });
    });
</script>
{% endblock %} 